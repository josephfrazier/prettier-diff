#!/usr/bin/env node

const fs = require('fs')
const child_process = require('child_process')
const prettierDiff = require('../')
const tempfile = require('tempfile')
const diff = require('diff')


const [fromPath, toPath] = process.argv.slice(2)

const fromContent = fs.readFileSync(fromPath).toString()
const toContent = fs.readFileSync(toPath).toString()

const {fromPretty, toPretty, patch} = prettierDiff({ fromPath, toPath, fromContent, toContent })

const [fromTmp, toTmp] = [tempfile(), tempfile()]

fs.writeFileSync(fromTmp, fromPretty)
fs.writeFileSync(toTmp, toPretty)

// Use `|| true` to eat failures.
// Don't use `| cat` because we want git diff colors to work if they are configured.
// https://stackoverflow.com/questions/255202/how-do-i-view-git-diff-output-with-a-visual-diff-program/255212#255212
child_process.execSync(`git diff --no-index "${fromTmp}" "${toTmp}" || true`, {
  stdio: 'inherit', // https://stackoverflow.com/questions/30134236/use-child-process-execsync-but-keep-output-in-console#comment61502598_31104898
})
